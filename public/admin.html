<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard - RockyStore Management</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; background: #0f172a; color: white; padding: 40px; margin: 0; }
        .container { max-width: 900px; margin: auto; }
        .panel { background: rgba(255, 255, 255, 0.05); padding: 30px; border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); }
        h2 { color: #38bdf8; text-align: center; margin-bottom: 30px; }
        
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        input, select { background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: white; padding: 12px; border-radius: 8px; width: 100%; box-sizing: border-box; }
        select option { background: #1e293b; }
        
        .btn-add { grid-column: span 2; background: #10b981; color: white; border: none; padding: 15px; border-radius: 10px; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 10px; }
        .btn-add:hover { background: #059669; transform: translateY(-2px); }

        .item-list { margin-top: 40px; display: grid; gap: 10px; }
        .item { background: rgba(255, 255, 255, 0.03); padding: 15px 25px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; border-left: 5px solid #38bdf8; }
        .item-info { display: flex; flex-direction: column; }
        .badge { font-size: 0.75rem; background: #38bdf8; color: #0f172a; padding: 2px 8px; border-radius: 4px; width: fit-content; margin-top: 5px; }
        .btn-del { background: #ef4444; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; transition: 0.2s; }
        .btn-del:hover { background: #dc2626; }
    </style>
</head>
<body>
    <div class="container">
        <div class="panel">
            <h2>üì¶ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ RockyStore</h2>
            
            <div class="form-grid">
                <input type="text" id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (‡πÄ‡∏ä‡πà‡∏ô RTX 4060)">
                <input type="number" id="price" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó)">
                <input type="text" id="img" placeholder="‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (URL)">
                <select id="category">
                    <option value="monitor">‡∏à‡∏≠‡∏Ñ‡∏≠‡∏°</option>
                    <option value="case">‡πÄ‡∏Ñ‡∏™‡∏Ñ‡∏≠‡∏°</option>
                    <option value="mainboard">‡πÄ‡∏°‡∏ô‡∏ö‡∏≠‡∏£‡πå‡∏î</option>
                    <option value="cpu">‡∏ã‡∏µ‡∏û‡∏µ‡∏¢‡∏π</option>
                    <option value="ram">‡πÅ‡∏£‡∏°</option>
                    <option value="ssd">‡∏Æ‡∏≤‡∏£‡πå‡∏î‡∏î‡∏¥‡∏™/‡πÄ‡∏≠‡∏™‡πÄ‡∏≠‡∏™‡∏î‡∏µ</option>
                    <option value="etc">‡∏à‡∏¥‡∏õ‡∏≤‡∏ñ‡∏∞</option>
                </select>
                <button class="btn-add" onclick="addProduct()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á</button>
            </div>

            <div class="item-list" id="admin-display">
                </div>
        </div>
    </div>

    <script>
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå Admin ‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
        const user = JSON.parse(localStorage.getItem('user'));
        if (!user || user.role !== 'admin') {
            window.location.href = '/login.html';
        }

        async function addProduct() {
            const data = {
                name: document.getElementById('name').value,
                price: Number(document.getElementById('price').value),
                img: document.getElementById('img').value,
                category: document.getElementById('category').value
            };

            const res = await fetch('/api/products', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            if (res.ok) {
                Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á‡πÅ‡∏•‡πâ‡∏ß', 'success')
                .then(() => location.reload());
            }
        }

        async function loadItems() {
            const res = await fetch('/api/products');
            const data = await res.json();
            document.getElementById('admin-display').innerHTML = data.map(p => `
                <div class="item">
                    <div class="item-info">
                        <span style="font-weight:600">${p.name}</span>
                        <span>${p.price.toLocaleString()} ‡∏ö‡∏≤‡∏ó</span>
                        <span class="badge">${p.category}</span>
                    </div>
                    <button class="btn-del" onclick="deleteItem('${p._id}')">‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
                </div>
            `).join('');
        }

        async function deleteItem(id) {
            const result = await Swal.fire({
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?',
                text: "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏•‡∏±‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#ef4444',
                confirmButtonText: '‡∏•‡∏ö‡πÄ‡∏•‡∏¢',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
            });

            if (result.isConfirmed) {
                await fetch(`/api/products/${id}`, { method: 'DELETE' });
                loadItems();
            }
        }

        loadItems();
    </script>
</body>
</html>