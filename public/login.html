<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Login - My Gadget Store</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; background: #0f172a; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .login-card { background: rgba(255, 255, 255, 0.05); padding: 2rem; border-radius: 20px; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); width: 350px; text-align: center; }
        h2 { color: #38bdf8; margin-bottom: 1.5rem; }
        input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: none; background: rgba(255, 255, 255, 0.1); color: white; box-sizing: border-box; }
        button { width: 100%; padding: 12px; border-radius: 8px; border: none; background: #38bdf8; color: #0f172a; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 10px; }
        button:hover { background: #0ea5e9; transform: translateY(-2px); }
        .toggle-link { margin-top: 15px; font-size: 0.9rem; color: #94a3b8; cursor: pointer; }
    </style>
</head>
<body>
    <div class="login-card">
        <h2 id="form-title">เข้าสู่ระบบ</h2>
        <input type="text" id="username" placeholder="ชื่อผู้ใช้">
        <input type="password" id="password" placeholder="รหัสผ่าน">
        <button onclick="handleAuth()" id="btn-auth">เข้าสู่ระบบ</button>
        <p class="toggle-link" onclick="toggleForm()" id="toggle-text">ยังไม่มีบัญชี? สมัครสมาชิก</p>
    </div>

    <script>
        let isLogin = true;
        function toggleForm() {
            isLogin = !isLogin;
            document.getElementById('form-title').innerText = isLogin ? 'เข้าสู่ระบบ' : 'สมัครสมาชิก';
            document.getElementById('btn-auth').innerText = isLogin ? 'เข้าสู่ระบบ' : 'สมัครสมาชิก';
            document.getElementById('toggle-text').innerText = isLogin ? 'ยังไม่มีบัญชี? สมัครสมาชิก' : 'มีบัญชีอยู่แล้ว? เข้าสู่ระบบ';
        }

        async function handleAuth() {
            const user = { username: document.getElementById('username').value, password:  document.getElementById('password').value };
            const endpoint = isLogin ? '/api/login' : '/api/register';
            
            const res = await fetch(endpoint, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(user)
            });
            const data = await res.json();

            if (res.ok) {
                Swal.fire('สำเร็จ!', data.message, 'success').then(() => {
                    if (isLogin) {
                        localStorage.setItem('user', JSON.stringify(data));
                        window.location.href = '/'; // กลับหน้าหลัก
                    } else { toggleForm(); }
                });
            } else { Swal.fire('ผิดพลาด', data.message, 'error'); }
        }
    </script>
</body>
</html>